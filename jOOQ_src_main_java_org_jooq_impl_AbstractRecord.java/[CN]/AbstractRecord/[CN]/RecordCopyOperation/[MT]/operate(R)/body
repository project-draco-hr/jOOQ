{
  try {
    for (    Field<?> targetField : record.fields()) {
      Field<?> sourceField=field(targetField);
      if (sourceField != null) {
        Utils.setValue(record,targetField,AbstractRecord.this,sourceField);
      }
    }
    if (record instanceof AbstractRecord) {
      UniqueKey<?> key=((AbstractRecord)record).getPrimaryKey();
      if (key != null) {
        boolean isKeySet=true;
        for (        Field<?> field : key.getFields()) {
          isKeySet=isKeySet && (field(field) != null);
        }
        if (isKeySet) {
          record.changed(false);
        }
      }
    }
    return record;
  }
 catch (  Exception e) {
    throw new MappingException("An error ocurred when mapping record to " + record,e);
  }
}
