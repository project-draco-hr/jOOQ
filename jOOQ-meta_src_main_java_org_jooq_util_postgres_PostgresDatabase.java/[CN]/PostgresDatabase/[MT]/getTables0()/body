{
  List<TableDefinition> result=new ArrayList<TableDefinition>();
  Map<Name,PostgresTableDefinition> map=new HashMap<Name,PostgresTableDefinition>();
  for (  Record record : create().select(TABLES.TABLE_SCHEMA,TABLES.TABLE_NAME).from(TABLES).where(TABLES.TABLE_SCHEMA.in(getInputSchemata())).orderBy(TABLES.TABLE_SCHEMA,TABLES.TABLE_NAME).fetch()) {
    SchemaDefinition schema=getSchema(record.getValue(TABLES.TABLE_SCHEMA));
    String name=record.getValue(TABLES.TABLE_NAME);
    String comment="";
    PostgresTableDefinition t=new PostgresTableDefinition(schema,name,comment);
    result.add(t);
    map.put(name(schema.getName(),name),t);
  }
  PgClass ct=PG_CLASS.as("ct");
  PgNamespace cn=PG_NAMESPACE.as("cn");
  PgInherits i=PG_INHERITS.as("i");
  PgClass pt=PG_CLASS.as("pt");
  PgNamespace pn=PG_NAMESPACE.as("pn");
  if (is84()) {
    for (    Record5<String,String,String,String,Integer> inheritance : create().select(cn.NSPNAME,ct.RELNAME,pn.NSPNAME,pt.RELNAME,max(i.INHSEQNO).over().partitionBy(i.INHRELID).as("m")).from(ct).join(cn).on(ct.RELNAMESPACE.eq(oid(cn))).join(i).on(i.INHRELID.eq(oid(ct))).join(pt).on(i.INHPARENT.eq(oid(pt))).join(pn).on(pt.RELNAMESPACE.eq(oid(pn))).fetch()) {
      Name child=name(inheritance.value1(),inheritance.value2());
      Name parent=name(inheritance.value3(),inheritance.value4());
      if (inheritance.value5() > 1) {
        log.info("Multiple inheritance","Multiple inheritance is not supported by jOOQ: " + child + " inherits from "+ parent);
      }
 else {
        PostgresTableDefinition childTable=map.get(child);
        PostgresTableDefinition parentTable=map.get(parent);
        if (childTable != null && parentTable != null) {
          childTable.setParentTable(parentTable);
          parentTable.getChildTables().add(childTable);
        }
      }
    }
  }
  return result;
}
