{
  try {
    R record;
    if (type == RecordImpl.class || type == Record.class) {
      record=(R)new RecordImpl(fields);
    }
 else {
      record=Reflect.accessible(type.getDeclaredConstructor()).newInstance();
    }
    if (attachRecords(configuration)) {
      record.attach(configuration);
    }
    return new RecordDelegate<R>(configuration,record);
  }
 catch (  Exception e) {
    throw new IllegalStateException("Could not construct new record",e);
  }
}
