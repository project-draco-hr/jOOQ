{
  String newContent=beforeClose(sb.toString());
  try {
    String oldContent=null;
    if (file.exists()) {
      RandomAccessFile old=null;
      try {
        old=new RandomAccessFile(file,"r");
        byte[] oldBytes=new byte[(int)old.length()];
        old.readFully(oldBytes);
        oldContent=new String(oldBytes,"UTF-8");
      }
  finally {
        if (old != null)         old.close();
      }
    }
    if (oldContent == null || !oldContent.equals(newContent)) {
      PrintWriter writer=new PrintWriter(new OutputStreamWriter(new FileOutputStream(file),"UTF-8"));
      writer.append(newContent);
      writer.flush();
      writer.close();
    }
  }
 catch (  IOException e) {
    throw new GeneratorException("Error writing " + file.getAbsolutePath());
  }
}
