{
  System.out.println("Transforming XML -> FO");
  InputStream isXML=Transform.class.getResourceAsStream(file("manual.xml"));
  InputStream isXSL=Transform.class.getResourceAsStream("pdf.xsl");
  StreamSource xsl=new StreamSource(isXSL);
  TransformerFactory factory=TransformerFactory.newInstance();
  Transformer transformer=factory.newTransformer(xsl);
  Match manual=$(isXML);
  replaceVariables(manual);
  checkCodeBlockLengths(manual);
  File dir=new File(baseDir + path("manual-pdf"));
  dir.mkdirs();
  FileOutputStream fout=new FileOutputStream(new File(dir,file("jOOQ-manual.fo.xml")));
  Source source=new DOMSource(manual.document());
  Result target=new StreamResult(fout);
  transformer.transform(source,target);
  fout.close();
  System.out.println("Transforming FO -> PDF");
  OutputStream out=null;
  fopFactory.setUserConfig(new File(Transform.class.getResource("/fop.config.xml").toURI()));
  FOUserAgent foUserAgent=fopFactory.newFOUserAgent();
  File file=new File(dir,file("jOOQ-manual.pdf"));
  out=new FileOutputStream(file);
  out=new BufferedOutputStream(out);
  Fop fop=fopFactory.newFop(MimeConstants.MIME_PDF,foUserAgent,out);
  transformer=factory.newTransformer();
  Source src=new StreamSource(new File(dir,file("jOOQ-manual.fo.xml")));
  Result res=new SAXResult(fop.getDefaultHandler());
  transformer.transform(src,res);
  out.flush();
  out.close();
  Runtime.getRuntime().exec(new String[]{"C:\\Program Files (x86)\\Adobe\\Reader 11.0\\Reader\\AcroRd32.exe",file.getAbsolutePath()});
}
