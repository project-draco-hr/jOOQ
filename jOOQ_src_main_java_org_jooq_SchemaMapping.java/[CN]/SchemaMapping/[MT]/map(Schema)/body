{
  if (!renderSchema)   return null;
  if (ignoreMapping)   return schema;
  Schema result=null;
  if (schema != null) {
    String schemaName=schema.getName();
    if (!StringUtils.isEmpty(schemaName)) {
      if (!getSchemata().containsKey(schemaName)) {
synchronized (this) {
          if (!getSchemata().containsKey(schemaName)) {
            Schema mapped=schema;
            for (            MappedSchema s : mapping.getSchemata()) {
              if (schemaName.equals(s.getInput())) {
                if (!isBlank(s.getOutput()) && !s.getOutput().equals(s.getInput())) {
                  mapped=new RenamedSchema(schema,s.getOutput());
                }
                break;
              }
            }
            getSchemata().put(schemaName,mapped);
          }
        }
      }
      result=getSchemata().get(schemaName);
      if (result.getName().equals(mapping.getDefaultSchema())) {
        result=null;
      }
    }
  }
  return result;
}
