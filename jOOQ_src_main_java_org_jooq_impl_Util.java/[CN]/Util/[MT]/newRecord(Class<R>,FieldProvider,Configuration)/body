{
  try {
    R result;
    if (type == RecordImpl.class) {
      result=(R)new RecordImpl(provider);
    }
 else {
      Constructor<R> constructor=type.getDeclaredConstructor();
      if (!constructor.isAccessible()) {
        constructor.setAccessible(true);
      }
      result=constructor.newInstance();
    }
    result.attach(configuration);
    return result;
  }
 catch (  Exception e) {
    throw new IllegalStateException("Could not construct new record",e);
  }
}
