{
  if (table.getPrimaryKey() != null) {
    Condition condition=null;
    List<Field<?>> key=new ArrayList<Field<?>>();
    for (    Field<?> f : table.getPrimaryKey().getFields()) {
      Field<Object> field=(Field<Object>)f;
      Field<Object> value=(Field<Object>)insertMaps.getMap().get(field);
      key.add(value);
      Condition other=field.equal(value);
      if (condition == null) {
        condition=other;
      }
 else {
        condition=condition.and(other);
      }
    }
    MergeOnConditionStep<R> on=create(configuration).mergeInto(table).usingDual().on(condition);
    MergeNotMatchedStep<R> notMatched=on;
    if (onDuplicateKeyUpdate) {
      notMatched=on.whenMatchedThenUpdate().set(updateMap);
    }
    return notMatched.whenNotMatchedThenInsert(insertMaps.getMap().keySet()).values(insertMaps.getMap().values());
  }
 else {
    throw new IllegalStateException("The ON DUPLICATE KEY IGNORE/UPDATE clause cannot be simulated when inserting into non-updatable tables : " + table);
  }
}
