{
  reset=false;
  connection.setAutoCommit(false);
  Field<Integer> count=count();
  Loader<A> loader=create().loadInto(TAuthor()).loadCSV("").fields(TAuthor_ID()).execute();
  assertEquals(0,loader.processed());
  assertEquals(0,loader.errors().size());
  assertEquals(0,loader.stored());
  assertEquals(0,loader.ignored());
  assertEquals(2,(int)create().select(count).from(TAuthor()).fetchOne(count));
  loader=create().loadInto(TAuthor()).loadCSV("3\n" + "4").fields(TAuthor_ID()).ignoreRows(0).execute();
  resetLoaderConnection();
  assertEquals(1,loader.processed());
  assertEquals(1,loader.errors().size());
  assertNotNull(loader.errors().get(0));
  assertEquals(0,loader.stored());
  assertEquals(1,loader.ignored());
  assertEquals(2,(int)create().select(count).from(TAuthor()).fetchOne(count));
  loader=create().loadInto(TAuthor()).onErrorIgnore().loadCSV("3\n" + "4").fields(TAuthor_ID()).ignoreRows(0).execute();
  resetLoaderConnection();
  assertEquals(2,loader.processed());
  assertEquals(2,loader.errors().size());
  assertNotNull(loader.errors().get(0));
  assertNotNull(loader.errors().get(1));
  assertEquals(0,loader.stored());
  assertEquals(2,loader.ignored());
  assertEquals(2,(int)create().select(count).from(TAuthor()).fetchOne(count));
  loader=create().loadInto(TAuthor()).onDuplicateKeyError().onErrorAbort().loadCSV("1;'Kafka'\n" + "2;Frisch").fields(TAuthor_ID(),TAuthor_LAST_NAME()).quote('\'').separator(';').ignoreRows(0).execute();
  resetLoaderConnection();
  assertEquals(1,loader.processed());
  assertEquals(1,loader.errors().size());
  assertNotNull(loader.errors().get(0));
  assertEquals(0,loader.stored());
  assertEquals(1,loader.ignored());
  assertEquals(2,(int)create().select(count).from(TAuthor()).fetchOne(count));
  loader=create().loadInto(TAuthor()).onDuplicateKeyIgnore().onErrorAbort().loadCSV("1,\"Kafka\"\n" + "2,Frisch").fields(TAuthor_ID(),TAuthor_LAST_NAME()).ignoreRows(0).execute();
  assertEquals(2,loader.processed());
  assertEquals(0,loader.errors().size());
  assertEquals(2,loader.ignored());
  assertEquals(2,(int)create().select(count).from(TAuthor()).fetchOne(count));
  loader=create().loadInto(TAuthor()).loadCSV("####Some Data####\n" + "\"ID\",\"Last Qualifier\"\r" + "3,Hesse\n"+ "4,Frisch").fields(TAuthor_ID(),TAuthor_LAST_NAME()).quote('"').separator(',').ignoreRows(2).execute();
  assertEquals(2,loader.processed());
  assertEquals(2,loader.stored());
  assertEquals(0,loader.ignored());
  assertEquals(0,loader.errors().size());
  assertEquals(2,(int)create().select(count).from(TAuthor()).where(TAuthor_ID().in(3,4)).and(TAuthor_LAST_NAME().in("Hesse","Frisch")).fetchOne(count));
  assertEquals(2,create().delete(TAuthor()).where(TAuthor_ID().in(3,4)).execute());
  loader=create().loadInto(TAuthor()).loadCSV("\"ID\",\"First Qualifier\",\"Last Qualifier\"\r" + "5,Hermann,Hesse\n" + "6,\"Max\",Frisch").fields(TAuthor_ID(),null,TAuthor_LAST_NAME()).execute();
  assertEquals(2,loader.processed());
  assertEquals(2,loader.stored());
  assertEquals(0,loader.ignored());
  assertEquals(0,loader.errors().size());
  Result<A> result=create().selectFrom(TAuthor()).where(TAuthor_ID().in(5,6)).and(TAuthor_LAST_NAME().in("Hesse","Frisch")).orderBy(TAuthor_ID()).fetch();
  assertEquals(2,result.size());
  assertEquals(5,(int)result.getValue(0,TAuthor_ID()));
  assertEquals(6,(int)result.getValue(1,TAuthor_ID()));
  assertEquals("Hesse",result.getValue(0,TAuthor_LAST_NAME()));
  assertEquals("Frisch",result.getValue(1,TAuthor_LAST_NAME()));
  assertEquals(null,result.getValue(0,TAuthor_FIRST_NAME()));
  assertEquals(null,result.getValue(1,TAuthor_FIRST_NAME()));
  assertEquals(2,create().delete(TAuthor()).where(TAuthor_ID().in(5,6)).execute());
switch (getDialect()) {
case ASE:
case DERBY:
case H2:
case INGRES:
case POSTGRES:
case SQLITE:
    log.info("SKIPPING","Duplicate record insertion");
  break;
default :
{
  loader=create().loadInto(TAuthor()).onDuplicateKeyUpdate().loadCSV("\"ID\",\"First Qualifier\",\"Last Qualifier\"\r" + "1,Hermann,Hesse\n" + "7,\"Max\",Frisch").fields(TAuthor_ID(),null,TAuthor_LAST_NAME()).execute();
  assertEquals(2,loader.processed());
  assertEquals(2,loader.stored());
  assertEquals(0,loader.ignored());
  assertEquals(0,loader.errors().size());
  result=create().selectFrom(TAuthor()).where(TAuthor_LAST_NAME().in("Hesse","Frisch")).orderBy(TAuthor_ID()).fetch();
  assertEquals(2,result.size());
  assertEquals(1,(int)result.getValue(0,TAuthor_ID()));
  assertEquals(7,(int)result.getValue(1,TAuthor_ID()));
  assertEquals("Hesse",result.getValue(0,TAuthor_LAST_NAME()));
  assertEquals("Frisch",result.getValue(1,TAuthor_LAST_NAME()));
  assertEquals("George",result.getValue(0,TAuthor_FIRST_NAME()));
  assertEquals(null,result.getValue(1,TAuthor_FIRST_NAME()));
  assertEquals(1,create().delete(TAuthor()).where(TAuthor_ID().in(7)).execute());
}
}
resetLoaderConnection();
loader=create().loadInto(TAuthor()).commitAll().onDuplicateKeyError().onErrorAbort().loadCSV("\"ID\",\"First Qualifier\",\"Last Qualifier\"\r" + "8,Hermann,Hesse\n" + "1,\"Max\",Frisch\n"+ "2,Friedrich,D??rrenmatt").fields(TAuthor_ID(),null,TAuthor_LAST_NAME()).execute();
assertEquals(2,loader.processed());
assertEquals(0,loader.stored());
assertEquals(1,loader.ignored());
assertEquals(1,loader.errors().size());
assertEquals(1,loader.errors().get(0).rowIndex());
assertEquals(Arrays.asList("1","Max","Frisch"),Arrays.asList(loader.errors().get(0).row()));
result=create().selectFrom(TAuthor()).where(TAuthor_ID().in(8)).orderBy(TAuthor_ID()).fetch();
assertEquals(0,result.size());
loader=create().loadInto(TAuthor()).commitAll().onDuplicateKeyIgnore().onErrorAbort().loadCSV("\"ID\",\"First Qualifier\",\"Last Qualifier\"\r" + "8,Hermann,Hesse\n" + "1,\"Max\",Frisch\n"+ "2,Friedrich,D??rrenmatt").fields(TAuthor_ID(),null,TAuthor_LAST_NAME()).execute();
assertEquals(3,loader.processed());
assertEquals(1,loader.stored());
assertEquals(2,loader.ignored());
assertEquals(0,loader.errors().size());
result=create().selectFrom(TAuthor()).where(TAuthor_ID().in(1,2,8)).orderBy(TAuthor_ID()).fetch();
assertEquals(3,result.size());
assertEquals(8,(int)result.getValue(2,TAuthor_ID()));
assertNull(result.getValue(2,TAuthor_FIRST_NAME()));
assertEquals("Hesse",result.getValue(2,TAuthor_LAST_NAME()));
assertEquals("Coelho",result.getValue(1,TAuthor_LAST_NAME()));
}
