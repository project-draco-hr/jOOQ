{
  Map<String,List<Query>> queries=new LinkedHashMap<String,List<Query>>();
  Boolean executeLogging=configuration.getSettings().isExecuteLogging();
  QueryCollector collector=new QueryCollector();
  try {
    configuration.setData(Utils.DATA_OMIT_RETURNING_CLAUSE,true);
    configuration.getExecuteListeners().add(collector);
    configuration.getSettings().setExecuteLogging(false);
    for (int i=0; i < records.length; i++) {
      Configuration previous=((AttachableInternal)records[i]).getConfiguration();
      try {
        records[i].attach(configuration);
        executeAction(i);
      }
 catch (      QueryCollectorException e) {
        Query query=e.getQuery();
        String sql=e.getSQL();
        if (query.isExecutable()) {
          List<Query> list=queries.get(sql);
          if (list == null) {
            list=new ArrayList<Query>();
            queries.put(sql,list);
          }
          list.add(query);
        }
      }
 finally {
        records[i].attach(previous);
      }
    }
  }
  finally {
    configuration.getData().remove(Utils.DATA_OMIT_RETURNING_CLAUSE);
    configuration.getExecuteListeners().remove(collector);
    configuration.getSettings().setExecuteLogging(executeLogging);
  }
  List<Integer> result=new ArrayList<Integer>();
  for (  Entry<String,List<Query>> entry : queries.entrySet()) {
    BatchBindStep batch=create.batch(entry.getValue().get(0));
    for (    Query query : entry.getValue()) {
      batch.bind(query.getBindValues().toArray());
    }
    int[] array=batch.execute();
    for (    int i : array) {
      result.add(i);
    }
  }
  int[] array=new int[result.size()];
  for (int i=0; i < result.size(); i++) {
    array[i]=result.get(i);
  }
  updateChangedFlag();
  return array;
}
