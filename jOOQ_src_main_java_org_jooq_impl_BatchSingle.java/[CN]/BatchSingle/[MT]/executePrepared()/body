{
  ExecuteContext ctx=new DefaultExecuteContext(configuration,new Query[]{query});
  ExecuteListener listener=new ExecuteListeners(ctx);
  Connection connection=ctx.connection();
  List<Param<?>> params=new ArrayList<Param<?>>(query.getParams().values());
  List<Object> previous=new ArrayList<Object>();
  for (  Param<?> param : params) {
    previous.add(param.getValue());
  }
  try {
    listener.renderStart(ctx);
    ctx.sql(create.render(query));
    listener.renderEnd(ctx);
    listener.prepareStart(ctx);
    ctx.statement(connection.prepareStatement(ctx.sql()));
    listener.prepareEnd(ctx);
    for (    Object[] bindValues : allBindValues) {
      listener.bindStart(ctx);
      for (int i=0; i < params.size(); i++) {
        params.get(i).setConverted(bindValues[i]);
      }
      visitAll(new DefaultBindContext(configuration,ctx.statement()),params);
      listener.bindEnd(ctx);
      ctx.statement().addBatch();
    }
    listener.executeStart(ctx);
    int[] result=ctx.statement().executeBatch();
    int[] batchRows=ctx.batchRows();
    for (int i=0; i < batchRows.length && i < result.length; i++)     batchRows[i]=result[i];
    listener.executeEnd(ctx);
    return result;
  }
 catch (  SQLException e) {
    ctx.sqlException(e);
    listener.exception(ctx);
    throw ctx.exception();
  }
 finally {
    Utils.safeClose(listener,ctx);
    for (int i=0; i < params.size(); i++) {
      params.get(i).setConverted(previous.get(i));
    }
  }
}
