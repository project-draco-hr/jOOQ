{
switch (dialect()) {
case SQLITE:
    log.info("SKIPPING","KeepResultSet tests");
  return;
}
DSLContext create=create(new NoSelectAfterRefreshListener());
Result<Record> b2=create.select().from(TBook().getName()).keepResultSet(KEEP_AFTER_FETCH).fetch();
Record r=b2.get(0);
assertNotNull(b2.resultSet());
assertNotNull(r.resultSet());
testFailUpdateRow(b2.resultSet());
r.setValue(TBook_TITLE(),"XX");
r.setValue(TBook_AUTHOR_ID(),15);
assertEquals("XX",r.getValue(TBook_TITLE()));
assertEquals(15,(int)r.getValue(TBook_AUTHOR_ID()));
assertTrue(r.changed());
assertFalse(r.original().equals(r));
B dbBook=getBook(1);
assertEquals(BOOK_TITLES.get(0),dbBook.getValue(TBook_TITLE()));
assertEquals(BOOK_AUTHOR_IDS.get(0),dbBook.getValue(TBook_AUTHOR_ID()));
r.refresh(TBook_TITLE());
assertEquals(BOOK_TITLES.get(0),r.getValue(TBook_TITLE()));
assertEquals(15,(int)r.getValue(TBook_AUTHOR_ID()));
assertTrue(r.changed());
assertFalse(r.original().equals(r));
r.refresh();
assertEquals(BOOK_TITLES.get(0),r.getValue(TBook_TITLE()));
assertEquals(BOOK_AUTHOR_IDS.get(0),r.getValue(TBook_AUTHOR_ID()));
assertFalse(r.changed());
assertEquals(r.original(),r);
b2.close();
assertNull(b2.resultSet());
testFailRefresh(r);
Cursor<Record> c1=create.select().from(TBook().getName()).keepResultSet(KEEP_AFTER_FETCH).fetchLazy();
assertFalse(c1.closesAfterFetch());
while (c1.hasNext()) {
Result<Record> result=c1.fetch(1);
assertNotNull(result.get(0).resultSet());
assertNotNull(result.resultSet());
assertNotNull(c1.resultSet());
}
assertNotNull(c1.resultSet());
c1.close();
assertNull(c1.resultSet());
}
