{
  if (isExecutable()) {
    StopWatch watch=new StopWatch();
    Configuration configuration=ConfigurationRegistry.provideFor(getConfiguration());
    if (configuration == null) {
      configuration=getConfiguration();
    }
    Connection connection=configuration.getConnection();
    if (connection == null) {
      throw new DetachedException("Cannot execute query. No Connection configured");
    }
    attach(configuration);
    watch.splitTrace("Parts attached");
    PreparedStatement statement=null;
    String sql=null;
    int result=0;
    try {
      sql=getSQL();
      watch.splitTrace("SQL rendered");
      boolean usePreparedStatement=getStatementType(getConfiguration().getSettings()) == PREPARED_STATEMENT;
      if (log.isDebugEnabled())       log.debug("Executing query",getSQL(true));
      if (log.isTraceEnabled() && usePreparedStatement)       log.trace("Preparing statement",sql);
      statement=prepare(configuration,sql);
      if (usePreparedStatement) {
        watch.splitTrace("Statement prepared");
        create(configuration).bind(this,statement);
        watch.splitTrace("Variables bound");
      }
      result=execute(configuration,statement);
      watch.splitTrace("Statement executed");
      return result;
    }
 catch (    SQLException e) {
      throw Util.translate("AbstractQuery.execute",sql,e);
    }
 finally {
      if (!keepStatementOpen()) {
        Util.safeClose(statement);
      }
      watch.splitDebug("Statement executed");
    }
  }
 else {
    if (log.isDebugEnabled()) {
      log.debug("Query is not executable",this);
    }
    return 0;
  }
}
