{
  if (isExecutable()) {
    Configuration c=org.jooq.ConfigurationRegistry.provideFor(getConfiguration());
    if (c == null) {
      c=getConfiguration();
    }
    ExecuteContext ctx=new DefaultExecuteContext(c,this);
    ExecuteListener listener=new ExecuteListeners(ctx);
    Connection connection=c.getConnection();
    if (connection == null) {
      throw new DetachedException("Cannot execute query. No Connection configured");
    }
    int result=0;
    try {
      if (statement != null) {
        ctx.sql(sql);
        ctx.statement(statement);
      }
 else {
        listener.renderStart(ctx);
        ctx.sql(getSQL());
        listener.renderEnd(ctx);
        if (keepStatement) {
          sql=ctx.sql();
        }
        listener.prepareStart(ctx);
        prepare(ctx);
        listener.prepareEnd(ctx);
        if (keepStatement) {
          statement=ctx.statement();
        }
      }
      if (timeout != 0) {
        ctx.statement().setQueryTimeout(timeout);
      }
      if (executePreparedStatements(c.getSettings())) {
        listener.bindStart(ctx);
        create(c).bind(this,ctx.statement());
        listener.bindEnd(ctx);
      }
      result=execute(ctx,listener);
      return result;
    }
 catch (    SQLException e) {
      ctx.sqlException(e);
      listener.exception(ctx);
      throw ctx.exception();
    }
 finally {
      if (!keepResult()) {
        Util.safeClose(listener,ctx,keepStatement);
      }
    }
  }
 else {
    if (log.isDebugEnabled()) {
      log.debug("Query is not executable",this);
    }
    return 0;
  }
}
