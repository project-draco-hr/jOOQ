{
  RecordMapper<R,E> mapper=new ReflectionMapper<R,E>(fields.fields,type);
  if (keys == null) {
    keys=new Field[0];
  }
  Map<Record,List<E>> map=new LinkedHashMap<Record,List<E>>();
  for (  R record : this) {
    @SuppressWarnings({"rawtypes","unchecked"}) Record key=new RecordImpl(keys);
    for (    Field<?> field : keys) {
      Utils.setValue(key,field,record,field);
    }
    List<E> list=map.get(key);
    if (list == null) {
      list=new ArrayList<E>();
      map.put(key,list);
    }
    list.add(mapper.map(record));
  }
  return map;
}
