{
  XPathFactory xpfactory=XPathFactory.newInstance();
  XPath xp=xpfactory.newXPath();
  List<Field<?>> fields=TBook().getFields();
  assertEquals("1",xp.evaluate("count(/result)",doc));
  assertEquals("1",xp.evaluate("count(/result/fields)",doc));
  assertEquals("" + fields.size(),xp.evaluate("count(/result/fields/field)",doc));
  for (int i=0; i < fields.size(); i++) {
    assertEquals(fields.get(i).getName(),xp.evaluate("/result/fields/field[" + (i + 1) + "]/@name",doc));
  }
  assertEquals("1",xp.evaluate("count(/result/records)",doc));
  assertEquals("4",xp.evaluate("count(/result/records/record)",doc));
  assertEquals("" + 4 * fields.size(),xp.evaluate("count(/result/records/record/value)",doc));
  for (int j=0; j < books.size(); j++) {
    for (int i=0; i < fields.size(); i++) {
      assertEquals(fields.get(i).getName(),xp.evaluate("/result/records/record[" + (j + 1) + "]/value["+ (i + 1)+ "]/@field",doc));
      assertEquals(books.getValueAsString(j,i,""),xp.evaluate("/result/records/record[" + (j + 1) + "]/value["+ (i + 1)+ "]/text()",doc));
    }
  }
}
