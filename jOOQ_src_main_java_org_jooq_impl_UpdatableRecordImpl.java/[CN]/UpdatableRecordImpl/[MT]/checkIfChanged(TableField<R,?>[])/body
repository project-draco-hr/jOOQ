{
  SelectQuery<R> select=create().selectQuery(getTable());
  Utils.addConditions(select,this,keys);
  if (create().configuration().dialect() != SQLDialect.SQLITE) {
    select.setForUpdate(true);
  }
  R record=select.fetchOne();
  if (record == null) {
    throw new DataChangedException("Database record no longer exists");
  }
  for (  Field<?> field : fields.fields) {
    Value<?> thisValue=getValue0(field);
    Value<?> thatValue=((AbstractRecord)record).getValue0(field);
    Object thisObject=thisValue.getOriginal();
    Object thatObject=thatValue.getOriginal();
    if (!StringUtils.equals(thisObject,thatObject)) {
      throw new DataChangedException("Database record has been changed");
    }
  }
}
