{
  Thread thread=Thread.currentThread();
  long threadID=thread.getId();
  ThreadInfo threadInfo=new ThreadInfo();
  boolean isAdded;
synchronized (idToThreadInfo) {
    isAdded=idToThreadInfo.put(threadID,threadInfo) != null;
  }
  CM_asyncExec asyncExec=new CM_asyncExec();
  asyncExec.setArgs(threadID,message);
  asyncSend(asyncExec);
  CommandResultMessage commandResultMessage=null;
synchronized (threadInfo) {
    while (commandResultMessage == null) {
      while (!threadInfo.isValuePresent()) {
        try {
          threadInfo.wait();
        }
 catch (        Exception e) {
        }
        if (!isAlive()) {
          idToThreadInfo.remove(threadID);
          printFailedInvocation(message);
          return null;
        }
      }
      Message value=threadInfo.getMessage();
      if (value instanceof CommandResultMessage) {
        commandResultMessage=(CommandResultMessage)value;
      }
 else {
        commandResultMessage=runMessage(value);
      }
    }
  }
  if (isAdded) {
synchronized (idToThreadInfo) {
      idToThreadInfo.remove(threadID);
    }
  }
  return processCommandResult(commandResultMessage);
}
