{
  if (log.isDebugEnabled()) {
    log.debug("[" + (isClient ? "client" : "server") + "] >RUN: "+ message.getID()+ ", "+ message);
  }
  CommandResultMessage<S> commandResultMessage;
  if (message instanceof CommandMessage) {
    CommandMessage<S> commandMessage=(CommandMessage<S>)message;
    S result=null;
    Throwable throwable=null;
    if (message.isValid()) {
      try {
        result=commandMessage.run(new MessageContext(comm));
      }
 catch (      Throwable t) {
        throwable=t;
      }
    }
    if (commandMessage.isSyncExec()) {
      commandResultMessage=new CommandResultMessage<S>(commandMessage.getID(),result,throwable);
      asyncSend(commandResultMessage);
    }
 else {
      commandResultMessage=new CommandResultMessage<S>(message.getID(),result,throwable);
    }
  }
 else {
    commandResultMessage=new CommandResultMessage<S>(message.getID(),null,null);
    if (message.isSyncExec()) {
      asyncSend(commandResultMessage);
    }
  }
  if (log.isDebugEnabled()) {
    log.debug("[" + (isClient ? "client" : "server") + "] <RUN: "+ message.getID());
  }
  return commandResultMessage;
}
