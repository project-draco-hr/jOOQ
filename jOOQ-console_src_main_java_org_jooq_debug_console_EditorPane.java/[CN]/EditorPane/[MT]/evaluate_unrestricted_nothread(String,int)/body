{
  closeLastExecution();
  SwingUtilities.invokeLater(new Runnable(){
    @Override public void run(){
      startButton.setVisible(false);
      stopButton.setVisible(true);
      stopButton.setToolTipText("Query started on " + Utils.formatDateTimeTZ(new Date()));
    }
  }
);
  StatementExecutor statementExecutor;
synchronized (STATEMENT_EXECUTOR_CREATOR_LOCK) {
    statementExecutor=statementExecutorCreator.createStatementExecutor();
    lastStatementExecutor=statementExecutor;
  }
  StatementExecution statementExecution;
  try {
    statementExecution=statementExecutor.execute(sql,isUsingMaxRowCount ? MAX_ROW_COUNT : Integer.MAX_VALUE,maxDisplayedRowCount);
  }
  finally {
    SwingUtilities.invokeLater(new Runnable(){
      @Override public void run(){
        startButton.setVisible(true);
        stopButton.setVisible(false);
        stopButton.setToolTipText(null);
      }
    }
);
  }
  final StatementExecutionResult[] results=statementExecution.getResults();
  final long executionDuration=statementExecution.getExecutionDuration();
  SwingUtilities.invokeLater(new Runnable(){
    @Override public void run(){
      for (      StatementExecutionResult result : results) {
        if (result instanceof StatementExecutionMessageResult) {
          StatementExecutionMessageResult messageResult=(StatementExecutionMessageResult)result;
          setMessage(addResultPane(),messageResult.getMessage(),messageResult.isError());
        }
 else         if (result instanceof StatementExecutionResultSetResult) {
          addResultTable(sql,executionDuration,(StatementExecutionResultSetResult)result);
        }
 else {
          throw new IllegalStateException("Unknown result class: " + result.getClass().getName());
        }
      }
    }
  }
);
}
