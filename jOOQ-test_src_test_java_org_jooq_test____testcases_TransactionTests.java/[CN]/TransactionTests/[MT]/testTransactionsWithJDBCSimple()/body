{
  try {
    create().transaction(new Transactional<Integer>(){
      @Override public Integer run(      Configuration configuration){
        assertFalse(((DefaultConnectionProvider)configuration.connectionProvider()).getAutoCommit());
        assertEquals(1,DSL.using(configuration).insertInto(TAuthor(),TAuthor_ID(),TAuthor_LAST_NAME()).values(3,"Koontz").execute());
        throw new MyRuntimeException("No");
      }
    }
);
    fail();
  }
 catch (  MyRuntimeException expected) {
    assertEquals("No",expected.getMessage());
    assertEquals(2,create().fetchCount(TAuthor()));
    assertTrue(create().configuration().connectionProvider().acquire().getAutoCommit());
  }
  assertEquals(2,create().fetchCount(TAuthor()));
}
