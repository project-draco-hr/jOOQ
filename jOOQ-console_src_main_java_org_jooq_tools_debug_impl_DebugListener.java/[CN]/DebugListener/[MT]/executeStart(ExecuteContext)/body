{
  List<Debugger> debuggerList=DebuggerRegistry.get();
  boolean hasBreakpointHitHandler=false;
  if (!debuggerList.isEmpty()) {
    QueryInfo queryInfo=null;
    bp:     for (    Debugger debugger : debuggerList) {
      Breakpoint[] breakpoints=debugger.getBreakpoints();
      if (breakpoints != null) {
        for (        Breakpoint breakpoint : breakpoints) {
          String sql_=null;
          String parameterDescription=null;
          if (queryInfo == null) {
            String[] sql=ctx.batchSQL();
            QueryType queryType=QueryType.detectType(sql[0]);
            if (sql.length == 1) {
              sql_=sql[0];
              PreparedStatement statement=ctx.statement();
              if (statement instanceof TrackingPreparedStatement) {
                parameterDescription=((TrackingPreparedStatement)statement).getParameterDescription();
              }
            }
 else {
              StringBuilder sb=new StringBuilder();
              for (int i=0; i < sql.length; i++) {
                if (i > 0) {
                  sb.append('\n');
                }
                sb.append(sql[i]);
              }
              sql_=sb.toString();
            }
            queryInfo=new QueryInfo(queryType,sql,parameterDescription);
          }
          if (breakpoint.matches(queryInfo)) {
            matchingSQL=sql_;
            matchingParameterDescription=parameterDescription;
            matchingDebugger=debugger;
            matchingBreakpoint=breakpoint;
            if (breakpoint.isBreaking()) {
              hasBreakpointHitHandler=debugger.getBreakpointHitHandler() != null;
            }
            break bp;
          }
        }
      }
    }
  }
  if (matchingBreakpoint != null) {
    QueryProcessor beforeExecutionProcessor=matchingBreakpoint.getBeforeExecutionProcessor();
    if (beforeExecutionProcessor != null) {
      String sql=beforeExecutionProcessor.processSQL(matchingSQL);
      long subStartExecutionTime=System.currentTimeMillis();
      executeSQL(ctx,sql);
      long subEndExecutionTime=System.currentTimeMillis();
      for (      Debugger debugger : debuggerList) {
        LoggingListener listener=debugger.getLoggingListener();
        if (listener != null) {
          QueryType type=QueryType.detectType(sql);
          QueryInfo info=new QueryInfo(type,new String[]{sql},null);
          QueryLog log=new QueryLog(info,null,null,subEndExecutionTime - subStartExecutionTime);
          QueryMatcher[] matchers=listener.getMatchers();
          if (matchers == null) {
            listener.logQuery(log);
          }
 else {
            for (            QueryMatcher matcher : matchers) {
              if (matcher.matches(log.getQueryInfo())) {
                listener.logQuery(log);
                break;
              }
            }
          }
        }
      }
    }
    String mainSQL=null;
    QueryProcessor replacementExecutionProcessor=matchingBreakpoint.getReplacementExecutionProcessor();
    if (replacementExecutionProcessor != null) {
      mainSQL=replacementExecutionProcessor.processSQL(matchingSQL);
      matchingParameterDescription=null;
      try {
        ctx.statement().close();
        ctx.sql(mainSQL);
        ctx.statement(ctx.getConnection().prepareStatement(mainSQL));
      }
 catch (      Exception e) {
        throw new RuntimeException(e);
      }
    }
    ExecutionType executionType=ExecutionType.RUN;
    if (hasBreakpointHitHandler) {
      effectiveSQL=mainSQL != null ? mainSQL : matchingSQL;
      Thread currentThread=Thread.currentThread();
      long threadID=currentThread.getId();
      String threadName=currentThread.getName();
      StackTraceElement[] callerStackTraceElements=currentThread.getStackTrace();
      callerStackTraceElements=Arrays.copyOfRange(callerStackTraceElements,2,callerStackTraceElements.length);
      BreakpointHit breakpointHit=new BreakpointHit(matchingBreakpoint.getID(),effectiveSQL,matchingParameterDescription,threadID,threadName,callerStackTraceElements,true);
      matchingDebugger.processBreakpointBeforeExecutionHit(ctx,breakpointHit);
      if (breakpointHit.getBreakpointID() == null) {
        executionType=breakpointHit.getExecutionType();
        String sql=breakpointHit.getSQL();
        if (sql != null) {
          effectiveSQL=sql;
          matchingParameterDescription=null;
          try {
            ctx.statement().close();
            ctx.sql(effectiveSQL);
            ctx.statement(ctx.getConnection().prepareStatement(effectiveSQL));
          }
 catch (          Exception e) {
            throw new RuntimeException(e);
          }
        }
      }
    }
    if (executionType != ExecutionType.STEP) {
      matchingDebugger=null;
    }
switch (executionType) {
case FAIL:
{
        throw new DataAccessException("Failing SQL statement.");
      }
case SKIP:
{
      try {
        ctx.statement().close();
        String sql=new Factory(ctx.getDialect()).selectZero().where("1 = 2").getSQL();
        ctx.sql(sql);
        ctx.statement(ctx.getConnection().prepareStatement(sql));
      }
 catch (      Exception e) {
        throw new RuntimeException(e);
      }
      break;
    }
}
}
if (!hasDebuggers) {
return;
}
startExecutionTime=System.currentTimeMillis();
}
