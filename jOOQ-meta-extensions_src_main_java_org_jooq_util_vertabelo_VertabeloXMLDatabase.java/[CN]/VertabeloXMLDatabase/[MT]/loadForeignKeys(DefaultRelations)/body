{
  for (  final Reference reference : databaseModel().getReferences()) {
    final Table pkTable=(Table)reference.getPKTable();
    final Table fkTable=(Table)reference.getFKTable();
    filterTablesBySchema(Arrays.asList(pkTable),new TableOperation(){
      @Override public void invoke(      Table table,      String schemaName){
        SchemaDefinition schema=getSchema(schemaName);
        TableDefinition pkTableDefinition=getTable(schema,pkTable.getName());
        TableDefinition fkTableDefinition=getTable(schema,fkTable.getName());
        String uniqueKeyName=findUniqueConstraintNameForReference(reference);
        if (uniqueKeyName == null) {
          return;
        }
        for (        ReferenceColumn referenceColumn : reference.getReferenceColumns()) {
          Column fkColumn=(Column)referenceColumn.getFKColumn();
          ColumnDefinition fkColumnDefinition=fkTableDefinition.getColumn(fkColumn.getName());
          relations.addForeignKey(reference.getName(),uniqueKeyName,fkColumnDefinition,pkTableDefinition.getSchema());
        }
      }
    }
);
  }
}
