{
  Thread clientThread=new Thread("SQL Remote Debugger Server-Client on port " + port){
    @Override public void run(){
      Debugger debugger=null;
      boolean isLogging=false;
      try {
        ObjectInputStream in=new ObjectInputStream(new BufferedInputStream(socket.getInputStream()));
        final ObjectOutputStream out=new ObjectOutputStream(new BufferedOutputStream(socket.getOutputStream()));
        debugger=new LocalDebugger(null);
        DebuggerRegistry.addSqlQueryDebugger(debugger);
        for (Message o; (o=(Message)in.readObject()) != null; ) {
          if (o instanceof ServerLoggingActivationMessage) {
            isLogging=((ServerLoggingActivationMessage)o).isLogging();
            if (isLogging) {
              debugger.setLoggingListener(new LoggingListener(){
                @Override public void logQueries(                QueryLoggingData queryLoggingData){
                  try {
                    out.writeObject(new ClientDebugQueriesMessage(queryLoggingData));
                    out.flush();
                  }
 catch (                  IOException e) {
                    e.printStackTrace();
                  }
                }
                @Override public void logResultSet(                int sqlQueryDebuggerDataID,                ResultSetLoggingData resultSetLoggingData){
                  try {
                    out.writeObject(new ClientDebugResultSetMessage(sqlQueryDebuggerDataID,resultSetLoggingData));
                    out.flush();
                  }
 catch (                  IOException e) {
                    e.printStackTrace();
                  }
                }
              }
);
            }
 else {
              debugger.setLoggingListener(null);
            }
          }
 else           if (o instanceof ServerLoggingStatementMatchersMessage) {
            debugger.setLoggingStatementMatchers(((ServerLoggingStatementMatchersMessage)o).getStatementMatchers());
          }
        }
      }
 catch (      Exception e) {
        if (isLogging) {
          e.printStackTrace();
        }
      }
 finally {
        if (debugger != null) {
          DebuggerRegistry.removeSqlQueryDebugger(debugger);
        }
      }
    }
  }
;
  clientThread.setDaemon(true);
  clientThread.start();
}
