{
  Connection connection=ctx.getConnection();
  boolean autoCommit=false;
  if (ctx.getDialect() == SQLDialect.POSTGRES && isSelectingRefCursor()) {
    autoCommit=connection.getAutoCommit();
    if (autoCommit) {
      if (log.isDebugEnabled())       log.debug("Unsetting auto-commit",false);
      connection.setAutoCommit(false);
    }
  }
  try {
    listener.executeStart(ctx);
    if (ctx.getDialect() == ASE) {
      ctx.resultSet(ctx.statement().executeQuery());
    }
 else     if (ctx.statement().execute()) {
      ctx.resultSet(ctx.statement().getResultSet());
    }
    listener.executeEnd(ctx);
    if (!many) {
      if (ctx.resultSet() != null) {
        FieldList fields=new FieldList(getFields(ctx.resultSet().getMetaData()));
        cursor=new CursorImpl<R>(ctx,listener,fields,getRecordType());
        if (!lazy) {
          result=cursor.fetch();
          cursor=null;
        }
      }
 else {
        result=new ResultImpl<R>(ctx,new FieldList());
      }
    }
 else {
      results=new ArrayList<Result<Record>>();
      while (ctx.resultSet() != null) {
        FieldProvider fields=new MetaDataFieldProvider(ctx,ctx.resultSet().getMetaData());
        Cursor<Record> c=new CursorImpl<Record>(ctx,listener,fields,true);
        results.add(c.fetch());
        if (ctx.statement().getMoreResults()) {
          ctx.resultSet(ctx.statement().getResultSet());
        }
 else {
          ctx.resultSet(null);
        }
      }
      ctx.statement().getMoreResults(Statement.CLOSE_ALL_RESULTS);
      ctx.statement().close();
    }
  }
  finally {
    if (autoCommit) {
      if (log.isDebugEnabled())       log.debug("Resetting auto-commit",autoCommit);
      connection.setAutoCommit(autoCommit);
    }
  }
  return result != null ? result.size() : 0;
}
