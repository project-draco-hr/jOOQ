{
  Connection connection=configuration.getConnection();
  boolean autoCommit=false;
  if (configuration.getDialect() == SQLDialect.POSTGRES && isSelectingRefCursor()) {
    autoCommit=connection.getAutoCommit();
    if (autoCommit) {
      if (log.isDebugEnabled())       log.debug("Unsetting auto-commit",false);
      connection.setAutoCommit(false);
    }
  }
  try {
    ResultSet rs=statement.executeQuery();
    if (!many) {
      FieldList fields=new FieldList(getFields(rs.getMetaData()));
      cursor=new CursorImpl<R>(configuration,fields,rs,statement,getRecordType());
      if (!lazy) {
        result=cursor.fetch();
        cursor=null;
      }
    }
 else {
      results=new ArrayList<Result<Record>>();
      for (; ; ) {
        FieldProvider fields=new MetaDataFieldProvider(configuration,rs.getMetaData());
        Cursor<Record> c=new CursorImpl<Record>(configuration,fields,rs);
        results.add(c.fetch());
        if (statement.getMoreResults()) {
          rs=statement.getResultSet();
        }
 else {
          break;
        }
      }
      statement.getMoreResults(Statement.CLOSE_ALL_RESULTS);
      statement.close();
    }
  }
  finally {
    if (autoCommit) {
      if (log.isDebugEnabled())       log.debug("Resetting auto-commit",autoCommit);
      connection.setAutoCommit(autoCommit);
    }
  }
  return result != null ? result.size() : 0;
}
