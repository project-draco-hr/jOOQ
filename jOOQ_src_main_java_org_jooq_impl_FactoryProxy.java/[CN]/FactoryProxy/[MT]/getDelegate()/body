{
  if (dataSource == null || dialect == null) {
    throw new DataAccessException("Both dataSource and dialect properties should be set");
  }
  try {
    Class<? extends Factory> clazz=getDialect().getFactory();
    Connection con=getDataSource().getConnection();
    Constructor<? extends Factory> constructor;
    if (settings == null) {
      constructor=clazz.getConstructor(Connection.class);
      return constructor.newInstance(con);
    }
 else {
      constructor=clazz.getConstructor(Connection.class,Settings.class);
      return constructor.newInstance(con,settings);
    }
  }
 catch (  Exception exc) {
    throw new DataAccessException("Failed to create jOOQ Factory",exc);
  }
}
