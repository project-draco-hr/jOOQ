{
  T result=null;
  DefaultTransactionContext ctx=new DefaultTransactionContext(configuration.derive());
  TransactionProvider provider=ctx.configuration().transactionProvider();
  try {
    provider.begin(ctx);
    result=transactional.run(ctx.configuration());
    provider.commit(ctx);
  }
 catch (  Exception cause) {
    provider.rollback(ctx.cause(cause));
    if (cause instanceof RuntimeException) {
      throw (RuntimeException)cause;
    }
 else {
      throw new DataAccessException("Rollback caused",cause);
    }
  }
  return result;
}
