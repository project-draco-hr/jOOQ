{
  ConnectionProvider provider=connectionProvider != null ? connectionProvider : getConnectionProvider();
  if (connection == null && provider != null) {
    Connection c=provider.acquire();
    if (c != null) {
      LOCAL_CONNECTION.set(c);
      connection=new SettingsEnabledConnection(new ProviderEnabledConnection(provider,c),getSettings());
    }
  }
  return connection;
}
